# 💬 Kawazu チャット使い方ガイド

## 🚀 チャットの開始方法

### ステップ1: ルームに参加
```bash
# ターミナルでコマンド実行
kawazu join daily-standup-2024

# パスワード付きプライベートルームの場合
kawazu join private-room -p password123
```

### ステップ2: エディターでファイルを開く
```bash
# 自動で作成される .codechat ファイルを開く
# VS Code の場合
code .codechat

# Cursor の場合  
cursor .codechat

# Vim の場合
vim .codechat
```

### ステップ3: メッセージを送信

#### 📝 通常メッセージの送信
```
===========================================
[過去のメッセージ履歴...]
===========================================

おはようございます！今日もよろしくお願いします

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

上記のように入力エリアに書いて **Ctrl+S で保存** → 自動的にチャットに送信される

#### 💻 コードの共有
```
===========================================
[過去のメッセージ履歴...]
===========================================

```javascript
function authenticate(token) {
  if (!token) {
    return { error: 'Token required' };
  }
  return { success: true };
}
```

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

コードブロックも同じように入力エリアに書いて保存すると送信される

#### 📁 ファイル共有コマンド
```bash
# ファイル共有リクエスト
kawazu share /src/components/Button.tsx --permission write --users yuki,takeshi

# ファイル共有承認/拒否
kawazu approve abc123def
kawazu deny abc123def
```

---

## 🎮 操作のポイント

### ✨ リアルタイム同期
- ファイルを保存する度に自動送信
- 他の参加者のメッセージもリアルタイムで表示
- 入力中の状態も共有される

### 🔄 ファイル監視システム
```
ファイル変更検知 → 新しい内容抽出 → サーバー送信 → 他の参加者に配信
     ↑                                                    ↓
   [保存]                                        [リアルタイム表示]
```

### 📋 .codechat ファイルの構造
```
===========================================
 Room: daily-standup-2024
 Members: takeshi, yuki, hiroshi, mei
===========================================

[10:30] takeshi: 過去のメッセージ1
[10:31] yuki: 過去のメッセージ2  
[10:32] hiroshi: 過去のメッセージ3

===========================================

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください

```

---

## 🛠️ 高度な使い方

### 1. **マルチライン メッセージ**
```
複数行のメッセージも
このように書けます。

空行があっても大丈夫です。
```

### 2. **コードブロック自動認識**
```python
# Python コードを書くと自動でシンタックスハイライト
def hello_world():
    print("Hello, Kawazu!")
    return True
```

### 3. **ファイル内コマンド実行**
```bash
# .codechat ファイル内でコマンドを書くと実行される
kawazu profile yuki
kawazu share /path/to/file.js
```

### 4. **コラボレーション機能**
```typescript
// リアルタイムでコードレビュー
interface User {
  id: string;        // ← hiroshi: この型定義いいね！
  name: string;      // ← yuki: バリデーション追加しよう
  email: string;     // ← takeshi: 修正済み ✅
}
```

---

## 🎯 使用例シナリオ

### 朝のスタンドアップ
```bash
# 1. ルーム参加
kawazu join morning-standup

# 2. エディターで .codechat を開く
code .codechat

# 3. 入力エリアに今日のタスクを書いて保存
```

```
===========================================
[過去のメッセージ履歴...]
===========================================

今日のタスク:
- APIの認証機能修正
- UIコンポーネントのテスト追加
- デプロイ準備

進捗で困っていること:
- CORS設定がうまくいかない...

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

### コードレビュー
```
===========================================
[過去のメッセージ履歴...]
===========================================

// 修正したコード
```javascript
function validateUser(userData) {
  if (!userData.email) {
    return false;
  }
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(userData.email);
}
```

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

### ペアプログラミング
```bash
# ファイル共有でリアルタイム編集
kawazu share /src/auth/login.ts --permission write --users yuki

# 共有されたファイルを同時編集
# 変更がリアルタイムで同期される
```

## 🎯 重要: メッセージの入力方法

### 📝 入力エリアの場所
```
===========================================
[過去のメッセージ履歴...]
===========================================

← この部分に書く！

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

### 🔄 送信の流れ
1. `.codechat` ファイルをエディターで開く
2. 最下部の線の**上**にメッセージを書く
3. **Ctrl+S でファイルを保存**
4. 自動的にチャットに送信される ✨

### ⚠️ 注意点
- 線の**上**に書く（線より下に書いても送信されません）
- 必ず `----->` の線より上の部分に入力してください
- ファイル保存 = メッセージ送信 です
- **最新7メッセージのみ表示**（古いメッセージは自動削除）

### 🚨 よくある間違い

**❌ 間違い: 過去のメッセージ部分に書く**
```
[10:30] takeshi: おはよう
[10:31] yuki: こんにちは
ここに書いてもダメ！ ← 送信されません
```

**✅ 正解: 線の上に書く**
```
[10:30] takeshi: おはよう
[10:31] yuki: こんにちは

ここに書く！

------------------------------------------------------------------------------>
メッセージを線の上に書きCtrl+Sで送信してください
```

## 📊 メッセージ表示の仕組み

### 🔄 7メッセージ制限
- チャット画面には**最新7つのメッセージのみ**表示
- 8つ目のメッセージが送信されると、一番古いメッセージが自動削除
- 新しいメッセージが下に追加され、古いメッセージは上にスクロールアップして消える

### 📈 動作例
```
初期状態（3メッセージ）:
[10:30] takeshi: おはよう
[10:31] yuki: こんにちは  
[10:32] hiroshi: 今日もよろしく

↓ 新しいメッセージが追加

7メッセージ後:
[10:30] takeshi: おはよう
[10:31] yuki: こんにちは
[10:32] hiroshi: 今日もよろしく
[10:33] mei: APIの件、確認しました
[10:34] takeshi: ありがとう！
[10:35] yuki: コードレビューお願いします
[10:36] hiroshi: 確認します

↓ 8つ目のメッセージが追加

自動スクロールアップ:
▲ [10:30] takeshi: おはよう ← 削除される
[10:31] yuki: こんにちは
[10:32] hiroshi: 今日もよろしく
[10:33] mei: APIの件、確認しました
[10:34] takeshi: ありがとう！
[10:35] yuki: コードレビューお願いします
[10:36] hiroshi: 確認します
[10:37] mei: 修正完了しました！ ← 新規追加
```

### 💡 メリット
- **軽快な動作**: ファイルサイズが増大しない
- **集中できる**: 最新の会話に集中
- **エディター最適化**: 重いファイルにならない

この革新的な方式により、普段使っているエディターから離れることなく、自然な形でチームとコミュニケーションできます！ 